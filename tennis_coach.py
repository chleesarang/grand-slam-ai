import streamlit as st
import tempfile
import os
from openai import OpenAI

# 1. í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="AI í…Œë‹ˆìŠ¤ ì½”ì¹˜", page_icon="ğŸ¾")

# 2. ì œëª©
st.title("ğŸ¾ AI í…Œë‹ˆìŠ¤ ì½”ì¹˜ í†µí•©ë²„ì „")
st.write("ê¸°ì´ˆ ë ˆìŠ¨ë¶€í„° ë‚´ ìŠ¤ìœ™ ë¶„ì„ê¹Œì§€ í•œ ë²ˆì—!")

# 3. API í‚¤ ì„¤ì • (Streamlit Secretsì—ì„œ ê°€ì ¸ì˜¤ê¸°)
if "OPENAI_API_KEY" in st.secrets:
    api_key = st.secrets["OPENAI_API_KEY"]
else:
    api_key = st.text_input("OpenAI API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”", type="password")

# 4. íƒ­ ìƒì„± (ì‚¬ë¼ì¡Œë˜ íƒ­ë“¤ì„ ë‹¤ì‹œ ë³µêµ¬í–ˆìŠµë‹ˆë‹¤!)
tab1, tab2, tab3, tab4 = st.tabs(["í™ˆ", "ê¸°ì´ˆ ìì„¸", "ê·¸ë¦½ ê°€ì´ë“œ", "ğŸ¥ ìŠ¤ìœ™ ì˜ìƒ ë¶„ì„"])

# --- íƒ­ 1: í™ˆ í™”ë©´ ---
with tab1:
    st.header("í™˜ì˜í•©ë‹ˆë‹¤!")
    st.write("í…Œë‹ˆìŠ¤ ì‹¤ë ¥ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•œ ëª¨ë“  ë„êµ¬ê°€ ì—¬ê¸°ì— ìˆìŠµë‹ˆë‹¤.")
    st.info("ì˜¤ë¥¸ìª½ ëì— ìˆëŠ” 'ğŸ¥ ìŠ¤ìœ™ ì˜ìƒ ë¶„ì„' íƒ­ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!")

# --- íƒ­ 2: ê¸°ì´ˆ ìì„¸ (ë³µêµ¬ë¨) ---
with tab2:
    st.header("í…Œë‹ˆìŠ¤ ê¸°ì´ˆ ìì„¸")
    st.write("1. **ì¤€ë¹„ ìì„¸ (Ready Position):** ë¬´ë¦ì„ ì•½ê°„ êµ½íˆê³  ë¼ì¼“ì„ ì •ë©´ìœ¼ë¡œ ë“­ë‹ˆë‹¤.")
    st.write("2. **ìŠ¤í”Œë¦¿ ìŠ¤í…:** ìƒëŒ€ê°€ ê³µì„ ì¹˜ëŠ” ìˆœê°„ ê°€ë³ê²Œ ì í”„í•©ë‹ˆë‹¤.")
    st.write("3. **í…Œì´í¬ë°±:** ê³µì´ ì˜¤ëŠ” ë°©í–¥ì„ í™•ì¸í•˜ê³  ë¯¸ë¦¬ ë¼ì¼“ì„ ë’¤ë¡œ ëºë‹ˆë‹¤.")
    # í•„ìš”í•˜ë‹¤ë©´ ì—¬ê¸°ì— ìœ íŠœë¸Œ ì˜ìƒ ë§í¬ë‚˜ ì´ë¯¸ì§€ë¥¼ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# --- íƒ­ 3: ê·¸ë¦½ ê°€ì´ë“œ (ë³µêµ¬ë¨) ---
with tab3:
    st.header("ê·¸ë¦½ ì¡ëŠ” ë²•")
    st.write("- **ì»¨í‹°ë„¨íƒˆ ê·¸ë¦½:** ì„œë¸Œì™€ ë°œë¦¬ì— ì í•©í•©ë‹ˆë‹¤. (ë§ì¹˜ ì¡ë“¯ì´)")
    st.write("- **ì´ìŠ¤í„´ ê·¸ë¦½:** í”Œë« í¬í•¸ë“œì— ìœ ë¦¬í•©ë‹ˆë‹¤.")
    st.write("- **ì„¸ë¯¸ ì›¨ìŠ¤í„´ ê·¸ë¦½:** í˜„ëŒ€ í…Œë‹ˆìŠ¤ì—ì„œ ê°€ì¥ ë§ì´ ì“°ëŠ” ìŠ¤í•€ìš© ê·¸ë¦½ì…ë‹ˆë‹¤.")

# --- íƒ­ 4: ì˜ìƒ ë¶„ì„ ê¸°ëŠ¥ (ìƒˆ ê¸°ëŠ¥) ---
with tab4:
    st.header("ìŠ¤ìœ™ ì˜ìƒ ì—…ë¡œë“œ & AI ì½”ì¹­")
    st.warning("âš ï¸ ëª¨ë°”ì¼ ë°ì´í„° ì£¼ì˜: ì˜ìƒì€ 10ì´ˆ ì´ë‚´ë¡œ ì§§ê²Œ ì°ì–´ì„œ ì˜¬ë ¤ì£¼ì„¸ìš”.")
    
    # íŒŒì¼ ì—…ë¡œë”
    uploaded_file = st.file_uploader("ì´¬ì˜í•œ ì˜ìƒì„ ì—…ë¡œë“œí•˜ì„¸ìš”", type=['mp4', 'mov', 'avi'])

    if uploaded_file is not None:
        # ì˜ìƒ ë¯¸ë¦¬ë³´ê¸°
        st.video(uploaded_file)
        
        analyze_button = st.button("AI ì½”ì¹˜ì—ê²Œ ë¶„ì„ ìš”ì²­")
        
        if analyze_button and api_key:
            client = OpenAI(api_key=api_key)
            
            with st.spinner("AIê°€ ìŠ¤ìœ™ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤..."):
                try:
                    # ì‹¤ì œ ì˜ìƒ ë¶„ì„ ëŒ€ì‹  í…ìŠ¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜ (ë¹„ì „ API ì—°ê²° ì „ í…ŒìŠ¤íŠ¸)
                    response = client.chat.completions.create(
                        model="gpt-4o",
                        messages=[
                            {"role": "system", "content": "ë‹¹ì‹ ì€ 20ë…„ ê²½ë ¥ì˜ í…Œë‹ˆìŠ¤ ì½”ì¹˜ì…ë‹ˆë‹¤. ì´ˆë³´ìì˜ ì˜ìƒì„ ë´¤ë‹¤ê³  ê°€ì •í•˜ê³ , ì„œë¸Œ ë™ì‘ì—ì„œ ê°€ì¥ í”íˆ í•˜ëŠ” ì‹¤ìˆ˜ì™€ êµì •ë²•ì„ ì¹œì ˆí•˜ê²Œ ì•Œë ¤ì£¼ì„¸ìš”."},
                            {"role": "user", "content": "ë°©ê¸ˆ ë‚´ ì„œë¸Œ ì˜ìƒì´ì•¼. í”¼ë“œë°± ì¢€ ì¤˜."}
                        ]
                    )
                    
                    result = response.choices[0].message.content
                    st.success("ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!")
                    st.markdown("### ğŸ“ AI ì½”ì¹˜ì˜ í”¼ë“œë°±")
                    st.markdown(result)
                    
                except Exception as e:
                    st.error(f"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
        elif analyze_button and not api_key:
            st.warning("API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
